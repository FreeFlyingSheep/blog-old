---
title: "MIPS 体系结构"
date: 2020-07-13
lastmod: 2020-07-15
tags: [MIPS, 体系结构]
categories: [MIPS]
draft: false
--- 

根据 *See MIPS Run (Second Edition)* (中文版) 整理，部分内容可能已经过时，见后续笔记。

<!--more-->

## 流水线

MIPS 的流水线对程序员不完全透明，由此带来了延迟槽问题：

- 分支延迟槽：紧跟在分支指令后的那条指令将被执行，对于条件分支问题需要特别小心
- 加载延迟槽：紧跟在加载指令后的那条指令不能使用刚刚加载的数据

利用该特性，可以把其他有用的指令移到在延迟槽运行，但现在这些步骤通常由汇编器完成。

## 虚拟地址空间

### 32 位虚拟地址空间

32 位地址空间如下图所示：
![32 位地址空间](/images/mips/address_space_32.png)

下面只考虑带 MMU 的机器，其余情况需要查相应机器的手册。

- `kuseg` (`0x0000 0000`-`0x7FFF FFFF`)：作为用户态可用的地址，这些地址将被 MMU 转换，不能在 MMU 设置好前使用。部分文档也将这部分空间称为 `useg`，但不建议这么称呼。

- `kseg0` (`0x8000 0000`-`0x9FFF FFFF`)：映射低 512 MB 物理地址，用于存放操作系统核心。通过把最高位清零转换成物理地址，但会经过高速缓存，因此需要先初始化高速缓存。

- `kseg1` (`0xA000 0000`-`0xBFFF FFFF`)：重复映射低 512 MB物理地址，用于存取初始的程序的 ROM以及作为 I/O 寄存器。通过把最高 3 位清零转换成物理地址，不会经过告诉缓存，因此是系统重启时唯一能正常工作的地址空间。复位入口点存放于 `0xBFC0 0000`，对应物理地址 `0x1FC0 0000`.

- `kseg2` (`0xC000 0000`-`0xFFFF FFFF`)：由操作系统内核使用，只能在内核态访问，需要被 MMU 转换，不能在 MMU 设置好前使用。

### 64 位虚拟地址空间

64 位地址空间被包在32 位地址空间中，如下图所示：
![64 位地址空间](/images/mips/address_space_64.png)

## 协处理器 0

TODO

## 高速缓存

### 对高速缓存编程

TODO

### 重影问题

TODO

## 异常、中断及初始化

### 异常

#### 精确异常

TODO

#### 异常处理流程

TODO

### 中断

TODO

### 初始化

TODO

## TLB

TODO

## ABI

## 调试

TODO

## Linux/MIPS

TODO
